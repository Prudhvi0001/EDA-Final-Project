---
title: "Effects of CaridoVascular Disease on Male and Female due to different factors"
author: "Prudhvi Vajja, Vijay Sai Kondamadugu"
date: "4/30/2020"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.height = 3, fig.width = 5)
```


```{r}
library(tidyverse)
library(ggplot2)
library(GGally)
cb_palette = c("darkslategrey","darkolivegreen3", "#56B4E9","#009E73", "#CC79A7", "#F0E442", "#0072B2","#D55E00","#999999","#E69F00")
```

Data is from link: https://www.kaggle.com/sulianova/cardiovascular-disease-dataset

```{r}
Data_cat = read.csv("cardio_train.csv", header = TRUE, sep = ";")
Data_cat.copy = Data_cat
```


```{r}
Data_cat$age = as.integer(Data_cat$age/365)
Data_cat = filter(Data_cat, ap_hi > 50 & ap_hi < 200, ap_lo > 50 & ap_lo < 100)


Data_cat.pres = Data_cat[Data_cat$cardio == 1, ]
Data_cat.abs = Data_cat[Data_cat$cardio == 0, ]


Data_cat$gender[Data_cat$gender==2] <- "Male"
Data_cat$gender[Data_cat$gender==1] <- "Female"
Data_cat$gender <- as.factor(Data_cat$gender)
```


```{r}
plot_graph1 <- function(Data, target){
  gg = ggplot(Data, aes(x = get(target), fill= as.factor(cardio))) + 
  geom_bar(width = 0.5, position=position_dodge())+ 
  xlab(target) + ylab("Count") + 
  ggtitle(paste("Distribution of overall data according to", target, sep = " ")) + 
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_fill_manual(name = "Cardiovascular \nDisease", values = cb_palette, labels=c("Absent", "Present")) + 
  theme(
  plot.title = element_text(size = 11, face = "bold"),
  plot.subtitle = element_text(size = 8),
  axis.title.x = element_text(size = 9),
  axis.title.y = element_text(size = 9),
  legend.title=element_text(size=9), 
  legend.text=element_text(size=8))
  return(gg)
}
```


```{r}
plot_graph2 <- function(Data, target){
gg = ggplot(Data_cat, aes(x = get(target), fill= as.factor(cardio))) + 
  geom_bar(binwidth = 2, position=position_dodge())+ 
  xlab(target) + ylab("Count") + 
  ggtitle(paste("Distribution of overall data according to", target, sep = " ")) + 
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_fill_manual(name = "Cardiovascular \nDisease", values = cb_palette, labels=c("Absent", "Present")) +
  facet_wrap(~gender)+
theme(
  plot.title = element_text(size = 11, face = "bold"),
  plot.subtitle = element_text(size = 8),
  axis.title.x = element_text(size = 9),
  axis.title.y = element_text(size = 9),
  legend.title=element_text(size=9), 
  legend.text=element_text(size=8))
  return(gg)
}
```


## Data Exploration

```{r}
gg = ggplot(Data_cat, aes(x = as.factor(cardio))) + 
  geom_bar(width = 0.25, fill="steelblue") + 
  ggtitle("Cardiovascular Disease") + 
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab(NULL) + ylab("Count") +
  scale_x_discrete(labels = c('Absence','Presence'))

gg + theme(
  plot.title = element_text(size = 11, face = "bold"),
  plot.subtitle = element_text(size = 8),
  axis.title.x = element_text(size = 9),
  axis.title.y = element_text(size = 9),
  legend.title=element_text(size=9), 
  legend.text=element_text(size=8))
```

* #People with and without cardiovascular disease in the given dataset are almost equal
* Absence = 35,021 and Presence = 34,979


Now lets explore each variable w.r.t Gender and cardiovascular disease:

```{r}
plot_graph1(Data_cat, "gender")
```

* 65% of this data has female population (count = 45,530) and remaining are male population (count = 24,470)
* There is a equal distribution of people with heart disease in both the genders
* 49.7% of female have heart disease and 50.5% of male have heart disease


In this data, there are 3 types of input features:

* Objective: factual information;
* Examination: results of medical examination;
* Subjective: information given by the patient.


***First let us look at objective features distribution conditioned on gender***

```{r}
plot_graph2(Data_cat, "height")
```


* Peak in female is between 155 to 165 cm approximately
* Whereas in male the peak of data is above 165 cm 
* Women with height above 160 cm are less prone to cardiovascular disease


```{r}
plot_graph2(Data_cat, "age")
```

* All of the heart disease patients in both male and female are above 35 years of age
* Very minute number of instances of people without heart disease in both gender have age below 30 years
* After the age of 55, in both male and female number of people with heart disease are more

```{r}
plot_graph2(Data_cat, "weight")
```

* There more number of people with heart disease when weight is above 70 kgs for women
* For men, when the weight is over 75 kgs people with heart disease are more

***Summary of Objective features***

* Taller women seem to be less prone to heart disease which is not exactle the case with men
* Irrespective of gender elderly people (>55 yrs) are more prone to heart disease
* After a threshold of weight, count of men and women with heart disease is more. Threshold for women is on lower side compared to men

***Now let us explore, Examination features - which are results of medical examination***


```{r}
plot_graph2(Data_cat, "ap_hi")
```

* Normal Systolic Blood pressure is 120
* There is a peak in both male and female at normal blood pressure
* People with abnormal systolic blood pressure are more prone to cardiovascular disease

```{r}
plot_graph2(Data_cat, "ap_lo")
```


* Normal Diastolic Blood pressure is 80
* In both male and female, peak in the distribution is at normal diastolic blood pressure
* Specifically, at 90 mmHg of Diastolic Blood pressure there very high number of heart patients in both male and female. But above 90 that's not the case



```{r}
objective_vars.male = Data_cat  %>% select(gender, age, height, weight, cardio) 
objective_vars.male = na.omit(objective_vars.male)
hd.obj.male.logit = glm(cardio ~ weight * gender + height + age,
                            family = "binomial", data = objective_vars.male)
hd.obj.male.logit.df = objective_vars.male
hd.obj.male.logit.df$.fitted = fitted.values(hd.obj.male.logit)
hd.obj.male.logit.df$.resid = residuals(hd.obj.male.logit, type = "response")

pred.value.prob = predict(hd.obj.male.logit, type = "response" , newdata = hd.obj.male.logit.df)
prediction = ifelse(pred.value.prob > 0.5, 1, 0)
```


```{r}
summary(hd.obj.male.logit)
```

```{r}
# # accuracy of the model
accuracy =  mean(hd.obj.male.logit.df$cardio == prediction ,na.rm= TRUE )
print("Accuracy")
accuracy*100
```


```{r}
x = data.frame(pred = pred.value.prob, value = prediction, cardio = as.factor(hd.obj.male.logit.df$cardio))
ggplot(x, aes(x = pred, group = cardio, fill = cardio)) + 
  geom_histogram() +
  labs(title = 'Distribution of fitted values for Male', subtitle = 'Using Objective Features') +
  xlab('Fitted Probability Values') +
  ylab('Count') +
  scale_fill_manual(values = cb_palette,
                    name="Cardiovascular \ndisease ",
                    labels=c("Absence", "Presence")) +
  scale_color_manual(values = cb_palette)+ 
  theme(
  plot.title = element_text(size = 11, face = "bold"),
  plot.subtitle = element_text(size = 8),
  axis.title.x = element_text(size = 9),
  axis.title.y = element_text(size = 9),
  legend.title=element_text(size=9), 
  legend.text=element_text(size=8))
```



```{r}
objective_vars.male = Data_cat  %>% select(gender, age, height, weight, cardio) 
objective_vars.male = na.omit(objective_vars.male)
hd.obj.male.logit = glm(cardio ~ weight * gender + height + age,
                            family = "binomial", data = objective_vars.male)
hd.obj.male.logit.df = objective_vars.male
hd.obj.male.logit.df$.fitted = fitted.values(hd.obj.male.logit)
hd.obj.male.logit.df$.resid = residuals(hd.obj.male.logit, type = "response")

pred.value.prob = predict(hd.obj.male.logit, type = "response" , newdata = hd.obj.male.logit.df)
prediction = ifelse(pred.value.prob > 0.5, 1, 0)
```


```{r}
summary(hd.obj.male.logit)
```

```{r}
# # accuracy of the model
accuracy =  mean(hd.obj.male.logit.df$cardio == prediction ,na.rm= TRUE )
print("Accuracy")
accuracy*100
```


```{r}
x = data.frame(pred = pred.value.prob, value = prediction, cardio = as.factor(hd.obj.male.logit.df$cardio))
ggplot(x, aes(x = pred, group = cardio, fill = cardio)) + 
  geom_histogram() +
  labs(title = 'Distribution of fitted values for Male', subtitle = 'Using Objective Features') +
  xlab('Fitted Probability Values') +
  ylab('Count') +
  scale_fill_manual(values = cb_palette,
                    name="Cardiovascular \ndisease ",
                    labels=c("Absence", "Presence")) +
  scale_color_manual(values = cb_palette)+ 
  theme(
  plot.title = element_text(size = 11, face = "bold"),
  plot.subtitle = element_text(size = 8),
  axis.title.x = element_text(size = 9),
  axis.title.y = element_text(size = 9),
  legend.title=element_text(size=9), 
  legend.text=element_text(size=8))
```



```{r}
objective_vars.male = Data_cat  %>% select(gender, age, height, weight, cardio) 
objective_vars.male = na.omit(objective_vars.male)
hd.obj.male.logit = glm(cardio ~ weight * gender + height + age,
                            family = "binomial", data = objective_vars.male)
hd.obj.male.logit.df = objective_vars.male
hd.obj.male.logit.df$.fitted = fitted.values(hd.obj.male.logit)
hd.obj.male.logit.df$.resid = residuals(hd.obj.male.logit, type = "response")

pred.value.prob = predict(hd.obj.male.logit, type = "response" , newdata = hd.obj.male.logit.df)
prediction = ifelse(pred.value.prob > 0.5, 1, 0)
```


```{r}
summary(hd.obj.male.logit)
```

```{r}
# # accuracy of the model
accuracy =  mean(hd.obj.male.logit.df$cardio == prediction ,na.rm= TRUE )
print("Accuracy")
accuracy*100
```


```{r}
x = data.frame(pred = pred.value.prob, value = prediction, cardio = as.factor(hd.obj.male.logit.df$cardio))
ggplot(x, aes(x = pred, group = cardio, fill = cardio)) + 
  geom_histogram() +
  labs(title = 'Distribution of fitted values for Male', subtitle = 'Using Objective Features') +
  xlab('Fitted Probability Values') +
  ylab('Count') +
  scale_fill_manual(values = cb_palette,
                    name="Cardiovascular \ndisease ",
                    labels=c("Absence", "Presence")) +
  scale_color_manual(values = cb_palette)+ 
  theme(
  plot.title = element_text(size = 11, face = "bold"),
  plot.subtitle = element_text(size = 8),
  axis.title.x = element_text(size = 9),
  axis.title.y = element_text(size = 9),
  legend.title=element_text(size=9), 
  legend.text=element_text(size=8))
```


```{r}
objective_vars.male = Data_cat  %>% select(gender, age, height, weight, cardio) 
objective_vars.male = na.omit(objective_vars.male)
hd.obj.male.logit = glm(cardio ~ weight * gender + height + age,
                            family = "binomial", data = objective_vars.male)
hd.obj.male.logit.df = objective_vars.male
hd.obj.male.logit.df$.fitted = fitted.values(hd.obj.male.logit)
hd.obj.male.logit.df$.resid = residuals(hd.obj.male.logit, type = "response")

pred.value.prob = predict(hd.obj.male.logit, type = "response" , newdata = hd.obj.male.logit.df)
prediction = ifelse(pred.value.prob > 0.5, 1, 0)
```


```{r}
summary(hd.obj.male.logit)
```

```{r}
# # accuracy of the model
accuracy =  mean(hd.obj.male.logit.df$cardio == prediction ,na.rm= TRUE )
print("Accuracy")
accuracy*100
```


```{r}
x = data.frame(pred = pred.value.prob, value = prediction, cardio = as.factor(hd.obj.male.logit.df$cardio))
ggplot(x, aes(x = pred, group = cardio, fill = cardio)) + 
  geom_histogram() +
  labs(title = 'Distribution of fitted values for Male', subtitle = 'Using Objective Features') +
  xlab('Fitted Probability Values') +
  ylab('Count') +
  scale_fill_manual(values = cb_palette,
                    name="Cardiovascular \ndisease ",
                    labels=c("Absence", "Presence")) +
  scale_color_manual(values = cb_palette)+ 
  theme(
  plot.title = element_text(size = 11, face = "bold"),
  plot.subtitle = element_text(size = 8),
  axis.title.x = element_text(size = 9),
  axis.title.y = element_text(size = 9),
  legend.title=element_text(size=9), 
  legend.text=element_text(size=8))
```







